---
hidden: true
title: "메시지 이벤트 집계 (Message Events Aggregation)"
description: "Notifly가 발송, 클릭, 오픈 및 기타 메시지 이벤트를 세는 방법."
---

## 개요

메시지 이벤트는 Campaign 메시지와 관련된 행동입니다 - 발송될 때, 사용자가 상호작용할 때, 실패할 때. 집계 시스템은 이러한 이벤트를 수집하여 대시보드에 표시합니다.

## 이벤트 소스

이벤트는 두 곳에서 옵니다:

### 서버 측 이벤트

메시지가 처리될 때 Notifly 서버에서 기록하는 이벤트.

| 소스 테이블 | `notifly_message_events` |
|-------------|--------------------------|
| 이벤트 | `send_success`, `send_failure`, `email_send`, `skipped__aborted_message` |
| 필터 | 상태가 `pending`인 이벤트 제외 |

### 클라이언트 측 이벤트

사용자가 메시지와 상호작용할 때 Notifly SDK에서 기록하는 이벤트.

| 소스 테이블 | `notifly_event_logs` |
|-------------|----------------------|
| 이벤트 | `in_app_message_show`, `in_web_message_show`, `push_click`, `main_button_click`, `link_open` |
| 필터 | `is_internal_event = true` AND `type = 'message_event'` |
| 제외 | 테스트 Campaign 무시 (`campaign_id NOT LIKE '%_test_%'`) |

## 표준 지표

| 지표 | 의미 | 소스 |
|------|------|------|
| `send_success` | 메시지가 성공적으로 발송됨 | 서버 |
| `send_failure` | 메시지 발송 실패 | 서버 |
| `email_send` | 이메일이 메일 서버로 전송됨 | 서버 |
| `email_open` | 사용자가 이메일을 열음 | 클라이언트 |
| `email_click` | 사용자가 이메일의 링크를 클릭함 | 서버 |
| `push_click` | 사용자가 푸시 알림을 탭함 | 클라이언트 |
| `in_app_message_show` | 인앱 메시지가 표시됨 | 클라이언트 |
| `in_web_message_show` | 인웹 메시지가 표시됨 | 클라이언트 |
| `main_button_click` | 사용자가 CTA 버튼을 클릭함 | 클라이언트 |
| `link_open` | 사용자가 링크를 클릭함 | 클라이언트 |

## 중복 제거

같은 이벤트가 여러 번 기록될 수 있습니다. 중복 계산을 피하기 위해:

### 작동 방식

1. 고유 키 생성: 메시지 ID의 처음 32자 + 채널
2. 중복이 있으면 다른 이벤트보다 `send_success` 선호
3. 고유 키당 하나의 이벤트만 유지

### 예시

같은 키를 가진 `send_success`와 `send_failure`가 모두 있는 메시지:
- 유지: `send_success`
- 삭제: `send_failure`

## 이벤트 복제 (변형)

일부 이벤트는 상세 추적을 위해 추가 "변형" 이벤트를 생성합니다:

### 실패 사유 추적

`send_failure` 발생 시:
- 원본 이벤트: `send_failure`
- 복제 생성: `send_failure:실패 사유=<reason>`

예: `send_failure:실패 사유=FCM-5XX` (FCM 서버 오류)

### 중단된 메시지 추적

`skipped__aborted_message` 발생 시:
- 원본 이벤트: `skipped__aborted_message`
- 복제 생성: `skipped__aborted_message:<message>`

### 카카오 대체 발송 추적

대체 발송이 구성된 카카오 채널:
- `kakao-friendtalk`
- `kakao-alimtalk`
- `kakao-brand-message`

대체 발송 발생 시 대체 발송 상태 텍스트와 함께 추가 변형이 생성됩니다.

## 집계 출력

### 그룹화

이벤트는 다음 기준으로 그룹화됩니다:
- Campaign ID
- Variant ID (A/B 테스트용)
- 채널
- 이벤트 이름
- 시간 (시간 버킷)
- 차원 (선택적 사용자 속성)

### 출력 형식

| 필드 | 설명 |
|------|------|
| `campaign_id` | Campaign 식별자 |
| `variant_id` | A/B 테스트 변형 (없으면 빈 값) |
| `channel` | 메시지 채널 (push, email 등) |
| `metric_name` | 이벤트 유형 (send_success, push_click 등) |
| `value` | 이벤트 횟수 |
| `collected_from` | 시간 버킷 시작 |
| `collected_to` | 시간 버킷 종료 |
| `dimension` | 사용자 속성 그룹화 (전체는 빈 값) |

### 시간 정밀도

- 이벤트가 **시간별 버킷**으로 그룹화됨
- 형식: `YYYY-MM-DD_HH`
- 예: `2024-01-15_09` (오전 9시 - 오전 10시 UTC)

## 처리 세부 사항

### 계산되는 것

| 포함 | 제외 |
|------|------|
| 일반 Campaign | 테스트 Campaign (ID에 `_test_` 포함) |
| 모든 표준 이벤트 | `pending` 상태인 이벤트 |
| 시간 윈도우 내 이벤트 | 수집 윈도우 외부의 이벤트 |

### 채널 처리

각 채널의 이벤트는 별도로 처리됩니다:
- `push` - 푸시 알림
- `email` - 이메일 메시지
- `sms` - SMS 메시지
- `kakao-*` - 카카오 채널
- `in-app-message` - 인앱 메시지
- `in-web-message` - 인웹 메시지

## 관련 문서

- [집계 개요](/ko/knowledge-base/campaigns/aggregation/index) - 집계 작동 방식
- [전환 추적](/ko/knowledge-base/campaigns/aggregation/conversion-tracking) - 전환 지표
- [차원](/ko/knowledge-base/campaigns/aggregation/dimensions) - 사용자 속성별 그룹화
- [Campaign 통계](/ko/knowledge-base/campaigns/statistics) - 상위 수준 개요
