---
hidden: true
title: "Liquid 템플릿"
description: "Liquid 템플릿을 사용하면 사용자 데이터, 이벤트 정보, 외부 콘텐츠로 메시지를 개인화할 수 있습니다."
---

## 개요

Liquid는 메시지에 동적 콘텐츠를 삽입할 수 있는 템플릿 언어입니다. 모든 사람에게 같은 메시지를 보내는 대신, 사용자의 이름, 최근 활동, 외부 소스의 데이터로 각 메시지를 개인화할 수 있습니다.

예를 들어, "안녕하세요 고객님" 대신 "안녕하세요 {{user.name}}님"이라고 작성하면 각 사용자가 자신의 이름을 볼 수 있습니다.

## 작동 방식

1. 특수 플레이스홀더(예: `{{user.name}}`)가 포함된 메시지를 작성합니다
2. 메시지가 발송되기 직전에 Notifly가 플레이스홀더를 실제 값으로 대체합니다
3. 각 사용자는 개인화된 메시지를 받습니다

## 사용 가능한 변수

### 사용자 변수

메시지를 받는 사용자에 대한 정보에 접근합니다.

| 변수 | 설명 | 예시 |
|----------|-------------|---------|
| `{{user.$user_id}}` | 사용자의 외부 ID | "user_12345" |
| `{{user.$email}}` | 사용자의 이메일 주소 | "john@example.com" |
| `{{user.$phone_number}}` | 사용자의 전화번호 | "+821012345678" |
| `{{user.$name}}` | 사용자 이름 | "김철수" |
| `{{user.custom_property}}` | 커스텀 사용자 속성 | 다양함 |

### 기기 변수

사용자의 기기에 대한 정보에 접근합니다.

| 변수 | 설명 | 예시 |
|----------|-------------|---------|
| `{{device.platform}}` | 기기 플랫폼 | "ios", "android", "web" |
| `{{device.timezone}}` | 기기 타임존 | "Asia/Seoul" |
| `{{device.app_version}}` | 앱 버전 | "2.1.0" |
| `{{device.os_version}}` | OS 버전 | "iOS 17.0" |

### Event 변수

메시지를 트리거한 event의 데이터에 접근합니다 (event 트리거 campaign의 경우).

| 변수 | 설명 | 예시 |
|----------|-------------|---------|
| `{{event.name}}` | Event 이름 | "purchase_completed" |
| `{{event.param_name}}` | 모든 event parameter | 다양함 |

예: 사용자가 `{product_name: "파란 셔츠", price: 29000}`로 "purchase_completed"를 트리거한 경우:
- `{{event.product_name}}` → "파란 셔츠"
- `{{event.price}}` → "29000"

### CSV 변수

CSV 업로드의 데이터에 접근합니다 (CSV 타겟팅이 있는 예약 campaign의 경우).

| 변수 | 설명 |
|----------|-------------|
| `{{csv.column_name}}` | CSV 열의 값 |

### Journey Entry 변수

사용자가 User Journey에 진입했을 때의 데이터에 접근합니다.

| 변수 | 설명 |
|----------|-------------|
| `{{entry_event.param_name}}` | Journey 진입 시 event parameter |
| `{{entry_csv.column_name}}` | Journey 진입 시 CSV 데이터 |

## 커스텀 태그

### Connected Content

메시지 렌더링 중 외부 API에서 데이터를 가져옵니다.

```liquid
{% connected_content https://api.example.com/user/{{user.$user_id}} :save result %}
안녕하세요 {{result.name}}님, {{result.points}} 포인트가 있습니다!
```

| 옵션 | 설명 |
|--------|-------------|
| `:save variable` | 응답을 변수에 저장 |
| `:headers` | 커스텀 HTTP 헤더 추가 |
| `:method` | HTTP 메서드 (GET, POST) |
| `:body` | POST 요청 본문 |
| `:content_type` | Content-Type 헤더 값 |
| `:basic_auth` | Basic 인증 자격 증명 |

**제한사항:**
- 타임아웃: 15초
- 캐시: 1분 (같은 URL은 캐시된 응답 반환)

### Abort Message

조건에 따라 메시지 발송을 중단합니다.

```liquid
{% if user.unsubscribed == true %}
  {% abort_message "사용자 구독 취소" %}
{% endif %}

안녕하세요 {{user.name}}님!
```

`abort_message`가 호출되면:
- 메시지가 발송되지 않음
- Skip type: `connected_content_abort`
- 디버깅을 위해 이유 텍스트가 로깅됨

## 채널 지원

모든 채널이 Liquid 템플릿을 지원하는 것은 아닙니다. 지원 현황:

| 채널 | 지원 | 지원 필드 |
|---------|---------|------------------|
| [푸시 알림](/ko/knowledge-base/channels/push-notification) | 전체 | title, body, action_url, custom_data |
| [웹 푸시](/ko/knowledge-base/channels/web-push) | 전체 | title, body, action_url, custom_data |
| [이메일](/ko/knowledge-base/channels/email) | 전체 | subject, body (HTML 이스케이프) |
| [SMS](/ko/knowledge-base/channels/sms) | 전체 | message_body, message_title (이모지 제거) |
| [카카오 알림톡](/ko/knowledge-base/channels/kakao-alimtalk) | 전체 | template params, failover text |
| [카카오 친구톡](/ko/knowledge-base/channels/kakao-friendtalk) | 전체 | header, text, buttons, links, carousel, commerce |
| [카카오 브랜드 메시지](/ko/knowledge-base/channels/kakao-brand-message) | 전체 | template params, failover text |
| [Webhook](/ko/knowledge-base/channels/webhook) | 전체 | url, headers, body |
| [LINE](/ko/knowledge-base/channels/line) | 없음 | 미구현 |
| [인앱 메시지](/ko/knowledge-base/channels/in-app-message) | 없음 | 사전 렌더링된 HTML 템플릿 사용 |
| [인웹 메시지](/ko/knowledge-base/channels/in-web-message) | 없음 | 사전 렌더링된 HTML 템플릿 사용 |

### 채널별 참고사항

**이메일:** HTML 콘텐츠는 XSS 공격을 방지하기 위해 자동으로 이스케이프됩니다. 예를 들어, `<script>`는 `&lt;script&gt;`가 됩니다.

**SMS:** 일부 통신사에서 인코딩 문제를 일으킬 수 있어 개인화된 콘텐츠에서 이모지가 자동으로 제거됩니다.

## 예시

### 간단한 개인화

```liquid
안녕하세요 {{user.$name | default: "고객"}}님!
```
결과: "안녕하세요 김철수님!" 또는 이름이 없으면 "안녕하세요 고객님!"

### 필터 사용

```liquid
주문 #{{event.order_id | upcase}}가 확정되었습니다.
총액: {{event.total | money}}
```

### 조건부 콘텐츠

```liquid
{% if user.membership == "premium" %}
  프리미엄 회원이 되어주셔서 감사합니다!
{% else %}
  프리미엄으로 업그레이드하시고 특별 혜택을 받으세요.
{% endif %}
```

### Connected Content 예시

```liquid
{% connected_content https://api.weather.com/current?city={{user.city}} :save weather %}
좋은 아침입니다! 오늘 {{user.city}}의 기온은 {{weather.temp}}°C입니다.
```

### 기본값

선택 데이터에는 항상 기본값을 제공하세요:

```liquid
안녕하세요 {{user.$name | default: "고객"}}님,
보유 포인트: {{user.points | default: 0}}
```

## 자주 하는 실수

### 기본값 누락

**잘못된 예:**
```liquid
안녕하세요 {{user.nickname}}님!
```
nickname이 비어있으면 사용자에게 보이는 결과: "안녕하세요 님!"

**올바른 예:**
```liquid
안녕하세요 {{user.nickname | default: user.$name | default: "고객"}}님!
```

### 잘못된 변수명

**잘못된 예:**
```liquid
{{user.email}}
```

**올바른 예:**
```liquid
{{user.$email}}
```
참고: 내장 사용자 속성은 `$`로 시작합니다

### 지원되지 않는 채널에서 Liquid 사용

LINE, 인앱, 인웹 메시지는 Liquid 템플릿을 처리하지 않습니다. 원시 템플릿 구문이 메시지에 그대로 나타납니다.

## 문제 해결

### 템플릿이 렌더링되지 않음

- 해당 채널이 Liquid를 지원하는지 확인 (위의 지원 표 참조)
- 변수명이 올바른지 확인 (내장 사용자 속성에 `$` 접두사 사용)
- 해당 사용자에게 데이터가 존재하는지 확인

### Connected Content 실패

- API URL이 Notifly 서버에서 접근 가능한지 확인
- API가 15초 이내에 응답하는지 확인
- 응답 형식이 예상과 일치하는지 검토
- 메시지가 중단되었는지 확인 (`connected_content_abort` skip type)

### 메시지 중단됨

메시지에 skip type `connected_content_abort`가 표시되면:
- `abort_message` 태그가 트리거되었는지 확인
- 발송 로그에서 중단 이유 검토
- connected content API가 예상 데이터를 반환하는지 확인

## 관련 문서

- [채널](/ko/knowledge-base/channels/index) - 채널별 개인화 지원
- [발송 필터링](/ko/knowledge-base/rules/delivery-filtering) - connected_content_abort를 포함한 skip type
- [Event](/ko/knowledge-base/concepts/events) - 개인화용 event 데이터
- [사용자와 기기](/ko/knowledge-base/concepts/users-and-devices) - 개인화용 사용자 속성
- [Campaign](/ko/knowledge-base/concepts/campaigns) - Campaign에서 템플릿 사용
- [User Journey](/ko/knowledge-base/concepts/user-journeys) - Journey에서 템플릿 사용
