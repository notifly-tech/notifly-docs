---
hidden: true
title: "발송 필터링 (Delivery Filtering)"
description: "발송 필터링은 메시지를 발송할지 건너뛸지 결정하는 프로세스입니다."
---

## 개요

메시지가 발송되기 전에 Notifly가 발송 필터링을 실행합니다. 이는 모든 규칙과 조건을 확인하여 메시지가 실제로 나가야 하는지 결정합니다. 어떤 규칙이든 실패하면 메시지가 "건너뛰기"됩니다.

## 작동 방식

1. 메시지가 발송 대기열에 들어감
2. 시스템이 모든 발송 정책 확인을 실행함
3. 각 확인이 통과하거나 실패함
4. 모두 통과하면 메시지가 발송됨
5. 하나라도 실패하면 메시지가 사유와 함께 건너뛰어짐

## 건너뛰기 유형

| 건너뛰기 유형 | 의미 | 참조 |
|---------------|------|------|
| `excluded_user_filter` | 사용자가 이 채널을 수신 거부함 | [제외 사용자](/ko/knowledge-base/rules/excluded-users) |
| `forbidden_timing_filter` | 발송 금지 시간에 메시지 발송 | [발송 금지 시간](/ko/knowledge-base/rules/forbidden-timing) |
| `fatigue_management` | Campaign 제한 도달 | [피로도 관리](/ko/knowledge-base/rules/fatigue-management) |
| `global_frequency_limit_filter` | 계정 제한 도달 | [글로벌 발송 빈도 제한](/ko/knowledge-base/rules/global-frequency-limit) |
| `noisy_filter` | 중복/불필요한 메시지 | 특수 케이스 |
| `connected_content_abort` | connected content가 발송을 중단함 | 템플릿 기능 |

## 검사 프로세스

발송 정책 검사가 반환하는 값:

| 필드 | 의미 |
|------|------|
| `notiflyUserId` | 대상 사용자 |
| `failToInspectDeliveryPolicy` | 확인 자체가 실패했는지 |
| `policyInspectionFailed` | 어떤 정책이 실패했는지 |
| `skip` | 메시지를 건너뛰어야 하는지 |
| `skipType` | 건너뛰기 사유 |
| `skipData` | 건너뛰기에 대한 추가 세부 정보 |

## 확인 순서

확인은 일반적으로 이 순서로 실행됩니다:
1. 제외 사용자
2. 발송 금지 시간
3. 피로도 관리
4. 글로벌 발송 빈도 제한

어떤 확인이든 실패하면 이후 확인이 실행되지 않을 수 있습니다.

## 건너뛰기 데이터

메시지가 건너뛰어질 때 추가 데이터가 기록될 수 있습니다:

**fatigue_management**의 경우:
- 현재 횟수
- 제한 값
- 시간 윈도우

**global_frequency_limit_filter**의 경우:
- 어떤 제한이 초과되었는지
- 횟수 대 제한

## 테스트/Webhook 예외

일부 Campaign은 특정 확인을 건너뜁니다:
- "test" 또는 "webhook"이 포함된 Campaign ID는 일부 정책을 우회할 수 있음
- 이는 테스트 및 Webhook 기능에 도움됨

## 실패 처리

검사 자체가 실패하면 (데이터베이스 오류 등):
- `failToInspectDeliveryPolicy`가 `true`로 설정됨
- 메시지가 여전히 발송을 시도하거나 재시도를 위해 보류될 수 있음
- 오류가 로깅됨

## 발송 실패 추적

메시지가 건너뛰어지거나 실패할 때:
- 이벤트 이름: `send_failure`
- 사유: `delivery_inspection_failure` 또는 특정 건너뛰기 유형
- 분석을 위해 로깅됨

## Connected Content 중단

이 건너뛰기 유형은 [Liquid 템플릿](/ko/knowledge-base/concepts/liquid-templates)을 사용하여 템플릿 로직에 의해 메시지가 의도적으로 중단될 때 발생합니다.

### 트리거 조건

1. **명시적 abort_message 태그:**
   ```liquid
   {% if user.do_not_contact == true %}
     {% abort_message "User requested no contact" %}
   {% endif %}
   ```

2. **중단이 포함된 connected content 실패:**
   ```liquid
   {% connected_content https://api.example.com/check/{{user.$user_id}} :save result %}
   {% if result.should_skip == true %}
     {% abort_message "API indicated skip" %}
   {% endif %}
   ```

### 기록되는 내용

| 필드 | 값 |
|------|-----|
| Skip type | `connected_content_abort` |
| Skip data | `abort_message`의 사유 텍스트 (제공된 경우) |

### 문제 해결 방법

1. **중단 사유 확인** - 발송 로그에서 `abort_message`에 전달된 메시지의 건너뛰기 데이터 확인
2. **템플릿 로직 검토** - 템플릿에서 `abort_message` 태그를 찾아 조건 확인
3. **connected content 테스트** - connected_content를 사용하는 경우 API가 예상 데이터를 반환하는지 확인
4. **타임아웃 확인** - connected content는 15초 타임아웃이 있음; 느린 API는 문제를 일으킬 수 있음

### 일반적인 원인

| 원인 | 해결책 |
|------|--------|
| API가 예기치 않은 데이터 반환 | API 엔드포인트와 응답 형식 확인 |
| API 타임아웃 (>15초) | API 응답 시간 최적화 또는 캐싱 사용 |
| 조건 로직 오류 | 테스트 데이터로 템플릿 조건 검토 |
| 누락된 사용자 데이터 | 기본값 추가 또는 null 케이스 처리 |

connected_content와 abort_message에 대한 전체 문서는 [Liquid 템플릿](/ko/knowledge-base/concepts/liquid-templates)을 참조하세요.

## 규칙

- 발송을 위해 모든 해당 확인이 통과해야 함
- 디버깅을 위해 건너뛰기 사유가 로깅됨
- 제외 사용자는 재정의 불가
- 글로벌 발송 빈도는 Campaign별로 우회 가능

## 건너뛰기 정보 조회

건너뛰기 정보는 다음에서 확인할 수 있습니다:
- 발송 로그
- Campaign 분석
- 사용자 메시지 기록

## 관련 문서

- [피로도 관리](/ko/knowledge-base/rules/fatigue-management) - Campaign 제한
- [글로벌 발송 빈도 제한](/ko/knowledge-base/rules/global-frequency-limit) - 계정 제한
- [발송 금지 시간](/ko/knowledge-base/rules/forbidden-timing) - 방해 금지 시간
- [제외 사용자](/ko/knowledge-base/rules/excluded-users) - 수신 거부
- [Liquid 템플릿](/ko/knowledge-base/concepts/liquid-templates) - 템플릿 기반 필터링 (abort_message)
- [규칙](/ko/knowledge-base/rules/index) - 모든 규칙
