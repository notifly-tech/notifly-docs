---
hidden: true
title: "Statistics Discrepancies (통계 불일치)"
description: "Campaign 수치가 예상과 맞지 않을 때."
---

## 개요

대시보드에서 보는 통계가 예상과 맞지 않는 경우가 있습니다. 이 가이드는 이유를 이해하고 대처 방법을 설명합니다.

## 파이프라인 이해하기

디버깅 전에 데이터 흐름을 파악하세요:

1. **이벤트 발생** → 사용자 행동 (발송, 클릭, 구매)
2. **이벤트 저장** → 원시 이벤트가 S3에 저장
3. **시간별 집계** → 작업이 이벤트를 통계로 처리
4. **데이터베이스 업데이트** → 결과가 PostgreSQL로 이동
5. **대시보드 표시** → 수치가 보임

자세한 문서는 [집계 개요](/ko/knowledge-base/campaigns/aggregation/index)를 참조하세요.

## 빠른 진단

| 증상 | 가능한 원인 | 해결책 |
|------|------------|--------|
| 수치가 낮아 보임 | 집계가 아직 실행 안됨 | 최대 1시간 대기 |
| 대시보드가 오래된 데이터 표시 | 60초 캐시 | 대기 후 새로고침 |
| 내보내기와 다른 수치 | 타임존 경계 | 날짜 필터 확인 |
| 어제 수치가 오늘 변경됨 | 지연 이벤트 처리 | 정상 동작 |
| 최근 campaign 통계 0 | 폴백 모드 활성 | `lastCollectedAt` 확인 |

## 일반적인 원인

### 1. 집계 지연

**현상**: 통계가 실시간이 아닌 시간별로 처리됨.

**증상**:
- 최근 이벤트가 표시 안됨
- 수치가 덩어리로 업데이트
- `lastCollectedAt`이 1시간 이상 전

**해결책**: 다음 집계 주기까지 최대 1시간 대기.

### 2. 60초 캐시

**현상**: 성능 향상을 위해 쿼리 결과가 캐시됨.

**증상**:
- 새로고침해도 같은 수치
- 최근 행동이 반영 안됨
- 여러 번 새로고침해도 안됨

**해결책**: 60초 대기 후 다시 새로고침.

### 3. 타임존 경계 문제

**현상**: UTC 저장 vs. KST 표시가 날짜 불일치를 유발할 수 있음.

**증상**:
- "오늘" 수치가 이상해 보임
- 늦은 밤 campaign이 다른 날짜에 표시
- 내보내기와 대시보드 수치가 다름

**타임존 작동 방식**:
- 데이터는 UTC로 저장
- KST (UTC+9)로 표시
- 오후 11시 KST = 같은 날 오후 2시 UTC
- 오전 1시 KST = 전날 오후 4시 UTC

**해결책**:
- 올바른 KST 날짜로 필터링하는지 확인
- 자정~오전 9시 KST 이벤트는 일부 내보내기에서 "전날"로 나타날 수 있음

### 4. 폴백 vs. 사전 집계 데이터

**현상**: 사전 집계 데이터가 없으면 시스템이 원시 이벤트 데이터를 사용.

**증상**:
- `lastCollectedAt`이 null
- 수치가 약간 다를 수 있음
- 로딩이 더 오래 걸림

**차이 이유**:
- 사전 집계: 표시에 최적화
- 폴백: 원시 계산
- 미세한 반올림 차이 가능

**해결책**: 보통 집계가 따라잡으면 해결됨.

### 5. 지연 이벤트 처리

**현상**: 일부 이벤트가 늦게 도착하여 이후 배치에서 집계됨.

**증상**:
- 어제 수치가 변경됨
- Campaign 종료 후 수치 증가
- 최종 수치가 초기와 다름

**해결책**: 정상 동작. 최종 수치는 24-48시간 대기.

### 6. 중복 제거 효과

**현상**: 시스템이 중복 이벤트를 제거하고 고유 키당 하나만 유지.

**중복 제거 방식**:
- 고유 키 = 메시지 ID 앞 32자 + 채널
- 중복이 있으면 `send_success`가 `send_failure`보다 선호됨
- 자세한 내용은 [메시지 이벤트](/ko/knowledge-base/campaigns/aggregation/message-events.md#deduplication) 참조

**증상**:
- 발송 수가 예상보다 적음
- 실패가 표시 안됨

**해결책**: 예상되는 동작. 각 메시지는 한 번만 집계되어야 함.

### 7. 대형 프로젝트 배치 지연

**현상**: 매우 큰 프로젝트는 배치로 처리되어 시간이 더 걸림.

**증상**:
- 다른 프로젝트보다 통계 업데이트가 느림
- 일부 journey만 업데이트됨

**배치 방식**:
- 시간 청킹: 1시간 배치
- Journey 배치: 작업당 10개 journey
- [Journey 집계](/ko/knowledge-base/journeys/aggregation.md#large-project-handling) 참조

**해결책**: 대형 프로젝트는 더 오래 대기. 지속적으로 느리면 엔지니어링팀 연락.

## 조사 방법

### 1단계: lastCollectedAt 확인
통계 응답의 `lastCollectedAt` 타임스탬프를 확인하세요.
- 최근 = 사전 집계 데이터 (신뢰할 수 있음)
- Null 또는 오래됨 = 폴백 사용 중일 수 있음

### 2단계: 날짜 범위 확인
날짜 필터가 예상과 일치하는지 확인:
- 대시보드는 KST 날짜 표시
- 늦은 밤 campaign은 두 KST 날에 걸칠 수 있음

### 3단계: 대기 및 재시도
- 60초 대기 (캐시)
- 최대 1시간 대기 (집계)
- 다시 확인

### 4단계: 원시 데이터와 비교
여전히 틀리면 다음과 비교:
- 해당 campaign의 이벤트 로그
- 발송 결과

## 전환 추적 문제

전환이 예상대로 표시되지 않을 때:

### 사전 전환 미기록

**문제**: 사용자가 전환했지만 집계 안됨.

**가능한 원인**:
- 메시지가 전달되지 않음 (`send_success` 미기록)
- DIRECT 전환: 사용자가 상호작용 안함 (클릭/오픈 없음)

**확인**: 로그에서 사전 전환 이벤트 찾기.

### 전환 창 만료

**문제**: 사용자가 너무 늦게 전환함.

**작동 방식**:
- 각 campaign에 전환 창 (1-14일)
- 시스템 최대값은 14일
- 창 밖 이벤트는 귀속되지 않음

**확인**: 전환 타임스탬프를 메시지 타임스탬프와 비교. 자세한 내용은 [전환 추적](/ko/knowledge-base/campaigns/aggregation/conversion-tracking.md#conversion-window) 참조.

### User/Device ID 불일치

**문제**: 시스템이 전환을 메시지 수신자와 연결 못함.

**매칭 순서**:
1. User ID 매칭
2. Device ID 매칭
3. Device 테이블 조회

**가능한 원인**:
- 메시지와 전환 사이에 사용자 로그아웃
- 다른 디바이스 사용
- 익명 사용자

**확인**: 메시지 이벤트와 전환 이벤트 간 user/device ID 비교.

### 필터 조건 미충족

**문제**: 전환이 발생했지만 campaign의 전환 기준에 맞지 않음.

**필터 작동 방식**:
- Campaign이 이벤트 속성으로 전환 필터링 가능
- 예: `category = 'electronics'`인 구매만 집계

**확인**: 전환 이벤트의 속성이 campaign의 필터 조건과 맞는지 확인. [필터 조건](/ko/knowledge-base/campaigns/aggregation/conversion-tracking.md#filter-conditions) 참조.

### 잘못된 전환 유형

**문제**: 잘못된 지표를 보고 있음.

**유형**:
| 유형 | 집계 대상 |
|------|----------|
| `total_count_conversion` | 전환한 모든 수신자 |
| `direct_count_conversion` | 클릭/상호작용 후 전환한 사람만 |

**확인**: 질문에 맞는 올바른 지표를 보고 있는지 확인.

## 에스컬레이션 시점

다음 경우 엔지니어링팀에 에스컬레이션:
- 24시간 후에도 수치가 업데이트 안됨
- `lastCollectedAt`이 24시간 이상 경과
- 큰 불일치 (>20%)가 지속
- 같은 campaign이 다른 곳에서 다른 수치 표시

**참고**: 통계는 집계 시스템에서 처리됩니다. 백엔드 작업에 대한 자세한 내용은 [캠페인 통계 - 집계 작동 방식](/ko/knowledge-base/campaigns/statistics.md#how-aggregation-works-backend)을 참조하세요.

## 제공할 정보

에스컬레이션 시 포함할 내용:
1. Campaign ID
2. Project ID
3. 쿼리 중인 날짜 범위
4. 예상 vs. 실제 수치
5. `lastCollectedAt` 값
6. 문제 스크린샷

## 관련 문서

- [캠페인 통계](/ko/knowledge-base/campaigns/statistics) - 통계 작동 방식
- [캠페인](/ko/knowledge-base/concepts/campaigns) - Campaign 기본
- [문제 해결 인덱스](/ko/knowledge-base/troubleshooting/index) - 기타 문제

### 집계 상세

- [집계 개요](/ko/knowledge-base/campaigns/aggregation/index) - 파이프라인 작동 방식
- [메시지 이벤트](/ko/knowledge-base/campaigns/aggregation/message-events) - 이벤트 유형과 중복 제거
- [전환 추적](/ko/knowledge-base/campaigns/aggregation/conversion-tracking) - 귀속 로직
- [차원](/ko/knowledge-base/campaigns/aggregation/dimensions) - 사용자 속성 그룹화
- [저니 집계](/ko/knowledge-base/journeys/aggregation) - Journey별 통계
